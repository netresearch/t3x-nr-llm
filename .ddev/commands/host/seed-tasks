#!/bin/bash

## Description: Import LLM Task seed data (one-shot prompt tasks)
## Usage: seed-tasks [database]
## Example: ddev seed-tasks
## Example: ddev seed-tasks v14

# Get the DDEV project root
DDEV_APPROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")/../.." && pwd)"
SQL_FILE="${DDEV_APPROOT}/sql/seed-tasks.sql"

# Default to v14 if no database specified
DATABASE="${1:-v14}"

if [ ! -f "$SQL_FILE" ]; then
    echo "❌ SQL file not found: $SQL_FILE"
    exit 1
fi

echo "⚡ Importing LLM Task seed data into database: $DATABASE"
echo ""

# Import the SQL file via ddev mysql
ddev mysql "$DATABASE" < "$SQL_FILE"

if [ $? -eq 0 ]; then
    echo ""
    echo "✅ Task seed data imported successfully!"
    echo ""
    echo "Pre-configured tasks:"
    echo "  Log Analysis: Analyze syslog, deprecation log, security events"
    echo "  Content Ops:  Alt text, meta descriptions, summaries, translations"
    echo "  System:       Broken links, redirect chain analysis"
    echo "  Developer:    TCA explanation, TypoScript fixes, Fluid analysis"
    echo ""
    echo "Access tasks in: Admin Tools → LLM → Tasks"
    echo ""
    echo "⚠️  REMINDER: Tasks are simple one-shot prompts, NOT AI agents."
    echo "    They cannot perform multi-step reasoning or use tools."
else
    echo ""
    echo "❌ Error importing seed data. Check database exists and tables are created."
    echo "Run: ddev exec -d /var/www/html/$DATABASE vendor/bin/typo3 database:updateschema"
    exit 1
fi
