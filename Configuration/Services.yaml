# Service configuration for nr-llm feature services
#
# This file defines dependency injection for high-level AI feature services
# that wrap LlmServiceManager with domain-specific logic and prompt engineering.

services:
  _defaults:
    autowire: true
    autoconfigure: true
    public: false

  # ========================================
  # Namespace Auto-registration
  # ========================================

  Netresearch\NrLlm\:
    resource: '../Classes/*'
    exclude: '../Classes/Domain/Model/*'

  # ========================================
  # Feature Services (PUBLIC)
  # ========================================
  # These are the main services consumed by other extensions

  Netresearch\NrLlm\Service\Feature\CompletionService:
    public: true
    arguments:
      $llmManager: '@Netresearch\NrLlm\Service\LlmServiceManager'

  Netresearch\NrLlm\Service\Feature\VisionService:
    public: true
    arguments:
      $llmManager: '@Netresearch\NrLlm\Service\LlmServiceManager'
      $promptService: '@Netresearch\NrLlm\Service\PromptTemplateService'

  Netresearch\NrLlm\Service\Feature\EmbeddingService:
    public: true
    arguments:
      $llmManager: '@Netresearch\NrLlm\Service\LlmServiceManager'
      $cacheManager: '@Netresearch\NrLlm\Service\CacheManager'

  Netresearch\NrLlm\Service\Feature\TranslationService:
    public: true
    arguments:
      $llmManager: '@Netresearch\NrLlm\Service\LlmServiceManager'
      $promptService: '@Netresearch\NrLlm\Service\PromptTemplateService'

  # ========================================
  # Supporting Services (PUBLIC)
  # ========================================

  Netresearch\NrLlm\Service\PromptTemplateService:
    public: true
    arguments:
      $repository: '@Netresearch\NrLlm\Domain\Repository\PromptTemplateRepository'

  Netresearch\NrLlm\Service\LlmServiceManager:
    public: true
    # Configuration will be defined in core LLM manager setup

  Netresearch\NrLlm\Service\CacheManager:
    public: true
    # Cache configuration will be defined separately

  # ========================================
  # Repositories
  # ========================================

  Netresearch\NrLlm\Domain\Repository\PromptTemplateRepository:
    public: true
    # Repository implementation will handle database operations

  # ========================================
  # Event Listeners (if needed)
  # ========================================
  # Event listeners for tracking feature service usage

  Netresearch\NrLlm\EventListener\PromptUsageTracker:
    tags:
      - name: event.listener
        identifier: 'prompt-usage-tracker'
        event: Netresearch\NrLlm\Event\AfterPromptRenderEvent
        method: 'trackUsage'
