# Service configuration for nr-llm extension
#
# This file defines dependency injection for AI/LLM services

services:
  _defaults:
    autowire: true
    autoconfigure: true
    public: false

  # ========================================
  # PSR-17 HTTP Factories
  # ========================================
  # Required for ProviderAdapterRegistry and HTTP client services
  # GuzzleHttp\Psr7\HttpFactory implements both RequestFactoryInterface and StreamFactoryInterface

  GuzzleHttp\Psr7\HttpFactory:
    public: false

  Psr\Http\Message\RequestFactoryInterface:
    alias: GuzzleHttp\Psr7\HttpFactory

  Psr\Http\Message\StreamFactoryInterface:
    alias: GuzzleHttp\Psr7\HttpFactory

  # ========================================
  # Namespace Auto-registration
  # ========================================

  Netresearch\NrLlm\:
    resource: '../Classes/*'
    exclude:
      - '../Classes/Domain/Model/*'
      - '../Classes/Provider/Exception/*'
      - '../Classes/Specialized/Exception/*'

  # ========================================
  # Core Services (PUBLIC)
  # ========================================

  Netresearch\NrLlm\Service\LlmServiceManager:
    public: true

  # ========================================
  # Providers (PUBLIC)
  # ========================================
  # All providers are registered via tags and auto-configured

  Netresearch\NrLlm\Provider\OpenAiProvider:
    public: true
    tags:
      - name: nr_llm.provider
        priority: 100

  Netresearch\NrLlm\Provider\ClaudeProvider:
    public: true
    tags:
      - name: nr_llm.provider
        priority: 90

  Netresearch\NrLlm\Provider\GeminiProvider:
    public: true
    tags:
      - name: nr_llm.provider
        priority: 80

  Netresearch\NrLlm\Provider\OpenRouterProvider:
    public: true
    tags:
      - name: nr_llm.provider
        priority: 70

  Netresearch\NrLlm\Provider\MistralProvider:
    public: true
    tags:
      - name: nr_llm.provider
        priority: 60

  Netresearch\NrLlm\Provider\GroqProvider:
    public: true
    tags:
      - name: nr_llm.provider
        priority: 50

  Netresearch\NrLlm\Provider\OllamaProvider:
    public: true
    tags:
      - name: nr_llm.provider
        priority: 40

  # ========================================
  # Provider Registry (handles auto-registration)
  # ========================================

  Netresearch\NrLlm\Provider\ProviderRegistry:
    public: false

  # ========================================
  # Provider Adapter Registry (database-backed providers)
  # ========================================

  Netresearch\NrLlm\Provider\ProviderAdapterRegistry:
    public: true

  # ========================================
  # Feature Services (PUBLIC)
  # ========================================

  Netresearch\NrLlm\Service\Feature\CompletionService:
    public: true

  Netresearch\NrLlm\Service\Feature\VisionService:
    public: true

  Netresearch\NrLlm\Service\Feature\EmbeddingService:
    public: true

  Netresearch\NrLlm\Service\Feature\TranslationService:
    public: true

  # ========================================
  # Supporting Services (PUBLIC)
  # ========================================

  Netresearch\NrLlm\Service\PromptTemplateService:
    public: true

  Netresearch\NrLlm\Service\CacheManager:
    public: true

  Netresearch\NrLlm\Service\LlmConfigurationService:
    public: true

  Netresearch\NrLlm\Service\UsageTrackerService:
    public: true

  # ========================================
  # Repositories (PUBLIC)
  # ========================================

  Netresearch\NrLlm\Domain\Repository\LlmConfigurationRepository:
    public: true

  Netresearch\NrLlm\Domain\Repository\ProviderRepository:
    public: true

  Netresearch\NrLlm\Domain\Repository\ModelRepository:
    public: true

  # ========================================
  # Crypto Services
  # ========================================

  Netresearch\NrLlm\Service\Crypto\ProviderEncryptionServiceInterface:
    alias: Netresearch\NrLlm\Service\Crypto\ProviderEncryptionService

  Netresearch\NrLlm\Service\Crypto\ProviderEncryptionService:
    public: true

  # ========================================
  # Translation Registry
  # ========================================

  Netresearch\NrLlm\Specialized\Translation\TranslatorRegistry:
    public: true

  # ========================================
  # Specialized Translators
  # ========================================
  # All translators are registered via tags and auto-configured

  Netresearch\NrLlm\Specialized\Translation\LlmTranslator:
    public: true
    tags:
      - name: nr_llm.translator
        priority: 100

  Netresearch\NrLlm\Specialized\Translation\DeepLTranslator:
    public: true
    tags:
      - name: nr_llm.translator
        priority: 90

  # ========================================
  # Speech Services
  # ========================================

  Netresearch\NrLlm\Specialized\Speech\WhisperTranscriptionService:
    public: true

  Netresearch\NrLlm\Specialized\Speech\TextToSpeechService:
    public: true

  # ========================================
  # Image Generation Services
  # ========================================

  Netresearch\NrLlm\Specialized\Image\DallEImageService:
    public: true

  Netresearch\NrLlm\Specialized\Image\FalImageService:
    public: true

  # ========================================
  # Setup Wizard Services
  # ========================================

  Netresearch\NrLlm\Service\SetupWizard\ProviderDetector:
    public: true

  Netresearch\NrLlm\Service\SetupWizard\ModelDiscovery:
    public: true

  Netresearch\NrLlm\Service\SetupWizard\ConfigurationGenerator:
    public: true
