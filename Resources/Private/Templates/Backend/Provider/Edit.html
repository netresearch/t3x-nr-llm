<html xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers"
      xmlns:be="http://typo3.org/ns/TYPO3/CMS/Backend/ViewHelpers"
      xmlns:core="http://typo3.org/ns/TYPO3/CMS/Core/ViewHelpers"
      data-namespace-typo3-fluid="true">

<f:layout name="Module" />

<f:section name="Content">
    <h1>
        <f:if condition="{isNew}">
            <f:then><f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:provider.edit.new" default="New API Provider" /></f:then>
            <f:else><f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:provider.edit.edit" default="Edit Provider" />: {provider.name}</f:else>
        </f:if>
    </h1>

    <f:if condition="{isNew}">
        <f:then>
            <f:form action="create" method="post">
                <f:render section="FormFields" arguments="{_all}" />
            </f:form>
        </f:then>
        <f:else>
            <f:form action="update" method="post" arguments="{uid: provider.uid}">
                <f:render section="FormFields" arguments="{_all}" />
            </f:form>
        </f:else>
    </f:if>
</f:section>

<f:section name="FormFields">
    <div class="row">
        <div class="col-lg-8">
            <!-- Identity Section -->
            <div class="card mb-4">
                <div class="card-header">
                    <h3 class="card-title">Identity</h3>
                </div>
                <div class="card-body">
                    <div class="form-group row mb-3">
                        <label class="col-sm-3 col-form-label" for="identifier">Identifier *</label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control" id="identifier"
                                   name="provider[identifier]"
                                   value="{provider.identifier}"
                                   required
                                   pattern="[a-z0-9_-]+"
                                   placeholder="openai_prod" />
                            <small class="form-text text-body-secondary">Unique technical identifier (lowercase, no spaces)</small>
                        </div>
                    </div>
                    <div class="form-group row mb-3">
                        <label class="col-sm-3 col-form-label" for="name">Name *</label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control" id="name"
                                   name="provider[name]"
                                   value="{provider.name}"
                                   required
                                   placeholder="OpenAI Production" />
                        </div>
                    </div>
                    <div class="form-group row mb-3">
                        <label class="col-sm-3 col-form-label" for="description">Description</label>
                        <div class="col-sm-9">
                            <textarea class="form-control" id="description"
                                      name="provider[description]"
                                      rows="2"
                                      placeholder="Optional description">{provider.description}</textarea>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Connection Section -->
            <div class="card mb-4">
                <div class="card-header">
                    <h3 class="card-title">Connection Settings</h3>
                </div>
                <div class="card-body">
                    <div class="form-group row mb-3">
                        <label class="col-sm-3 col-form-label" for="adapterType">Adapter Type *</label>
                        <div class="col-sm-9">
                            <select class="form-control" id="adapterType"
                                    name="provider[adapterType]"
                                    required>
                                <option value="">-- Select Adapter --</option>
                                <f:for each="{adapterTypes}" as="label" key="value">
                                    <option value="{value}"
                                            {f:if(condition: '{provider.adapterType} == {value}', then: 'selected')}>
                                        {label}
                                    </option>
                                </f:for>
                            </select>
                            <small class="form-text text-body-secondary">The API protocol adapter to use</small>
                        </div>
                    </div>
                    <div class="form-group row mb-3">
                        <label class="col-sm-3 col-form-label" for="endpointUrl">Endpoint URL</label>
                        <div class="col-sm-9">
                            <input type="url" class="form-control" id="endpointUrl"
                                   name="provider[endpointUrl]"
                                   value="{provider.endpointUrl}"
                                   placeholder="https://api.openai.com/v1" />
                            <small class="form-text text-body-secondary">Custom API endpoint URL (leave empty for default)</small>
                        </div>
                    </div>
                    <div class="form-group row mb-3">
                        <label class="col-sm-3 col-form-label" for="apiKey">API Key *</label>
                        <div class="col-sm-9">
                            <input type="password" class="form-control" id="apiKey"
                                   name="provider[apiKey]"
                                   value="{provider.apiKey}"
                                   placeholder="sk-..." />
                            <small class="form-text text-body-secondary">Your API key for authentication</small>
                        </div>
                    </div>
                    <div class="form-group row mb-3">
                        <label class="col-sm-3 col-form-label" for="organizationId">Organization ID</label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control" id="organizationId"
                                   name="provider[organizationId]"
                                   value="{provider.organizationId}"
                                   placeholder="org-..." />
                            <small class="form-text text-body-secondary">Optional organization ID (OpenAI, Azure)</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Advanced Settings -->
            <div class="card mb-4">
                <div class="card-header">
                    <h3 class="card-title">Advanced Settings</h3>
                </div>
                <div class="card-body">
                    <div class="form-group row mb-3">
                        <label class="col-sm-3 col-form-label" for="timeout">Timeout (seconds)</label>
                        <div class="col-sm-9">
                            <input type="number" class="form-control" id="timeout"
                                   name="provider[timeout]"
                                   value="{f:if(condition: provider, then: provider.timeout, else: '30')}"
                                   min="1" max="300" />
                            <small class="form-text text-body-secondary">Request timeout in seconds</small>
                        </div>
                    </div>
                    <div class="form-group row mb-3">
                        <label class="col-sm-3 col-form-label" for="maxRetries">Max Retries</label>
                        <div class="col-sm-9">
                            <input type="number" class="form-control" id="maxRetries"
                                   name="provider[maxRetries]"
                                   value="{f:if(condition: provider, then: provider.maxRetries, else: '3')}"
                                   min="0" max="10" />
                            <small class="form-text text-body-secondary">Number of retry attempts on failure</small>
                        </div>
                    </div>
                    <div class="form-group row mb-3">
                        <label class="col-sm-3 col-form-label" for="options">Additional Options</label>
                        <div class="col-sm-9">
                            <textarea class="form-control" id="options"
                                      name="provider[options]"
                                      rows="3"
                                      placeholder='{"custom_header": "value"}'>{provider.options}</textarea>
                            <small class="form-text text-body-secondary">Additional provider-specific options as JSON</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <!-- Status Section -->
            <div class="card mb-4">
                <div class="card-header">
                    <h3 class="card-title">Status</h3>
                </div>
                <div class="card-body">
                    <div class="form-check mb-3">
                        <input type="hidden" name="provider[isActive]" value="0" />
                        <input type="checkbox" class="form-check-input" id="isActive"
                               name="provider[isActive]" value="1"
                               {f:if(condition: '{provider.isActive} || {isNew}', then: 'checked')} />
                        <label class="form-check-label" for="isActive">Active</label>
                    </div>
                </div>
            </div>

            <!-- Actions -->
            <div class="card">
                <div class="card-body">
                    <button type="submit" class="btn btn-primary btn-block mb-2">
                        <core:icon identifier="actions-save" />
                        <f:if condition="{isNew}">
                            <f:then>Create Provider</f:then>
                            <f:else>Save Provider</f:else>
                        </f:if>
                    </button>
                    <f:link.action action="list" class="btn btn-default btn-block">
                        Cancel
                    </f:link.action>
                </div>
            </div>

            <!-- Help Section -->
            <div class="card mt-4">
                <div class="card-header">
                    <h3 class="card-title">Help</h3>
                </div>
                <div class="card-body">
                    <h5>Adapter Types</h5>
                    <dl class="mb-0">
                        <dt>OpenAI</dt>
                        <dd class="text-body-secondary small">For OpenAI API and compatible endpoints</dd>
                        <dt>Anthropic</dt>
                        <dd class="text-body-secondary small">For Claude models via Anthropic API</dd>
                        <dt>Gemini</dt>
                        <dd class="text-body-secondary small">For Google Gemini models</dd>
                        <dt>OpenRouter</dt>
                        <dd class="text-body-secondary small">Multi-provider router service</dd>
                        <dt>Ollama</dt>
                        <dd class="text-body-secondary small">Local Ollama instance</dd>
                        <dt>Azure OpenAI</dt>
                        <dd class="text-body-secondary small">Azure-hosted OpenAI models</dd>
                    </dl>
                </div>
            </div>
        </div>
    </div>
</f:section>

</html>
