<html xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers"
      xmlns:be="http://typo3.org/ns/TYPO3/CMS/Backend/ViewHelpers"
      xmlns:core="http://typo3.org/ns/TYPO3/CMS/Core/ViewHelpers"
      data-namespace-typo3-fluid="true">

<f:layout name="Module" />

<f:section name="Content">
    <div class="container">
        <h1>
            <f:if condition="{isNew}">
                <f:then><f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:provider.edit.new" default="New API Provider" /></f:then>
                <f:else><f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:provider.edit.edit" default="Edit Provider" />: {provider.name}</f:else>
            </f:if>
        </h1>

        <f:if condition="{isNew}">
            <f:then>
                <f:form action="create" method="post">
                    <f:render section="FormFields" arguments="{_all}" />
                </f:form>
            </f:then>
            <f:else>
                <f:form action="update" method="post" arguments="{uid: provider.uid}">
                    <f:render section="FormFields" arguments="{_all}" />
                </f:form>
            </f:else>
        </f:if>
    </div>
</f:section>

<f:section name="FormFields">
    <div class="row">
        <div class="col-lg-8">
            <f:comment>Identity Section</f:comment>
            <div class="card mb-4">
                <div class="card-header">
                    <h2 class="card-title"><f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:provider.section.identity" default="Identity" /></h2>
                </div>
                <div class="card-body">
                    <div class="mb-3 row">
                        <label class="col-sm-3 col-form-label" for="identifier">
                            <f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:provider.field.identifier" default="Identifier" /> *
                        </label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control" id="identifier"
                                   name="provider[identifier]"
                                   value="{provider.identifier}"
                                   required
                                   pattern="[a-z0-9_-]+"
                                   placeholder="openai_prod" />
                            <div class="form-text"><f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:provider.field.identifier.help" default="Unique technical identifier (lowercase, no spaces)" /></div>
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <label class="col-sm-3 col-form-label" for="name">
                            <f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:provider.field.name" default="Name" /> *
                        </label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control" id="name"
                                   name="provider[name]"
                                   value="{provider.name}"
                                   required
                                   placeholder="OpenAI Production" />
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <label class="col-sm-3 col-form-label" for="description">
                            <f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:provider.field.description" default="Description" />
                        </label>
                        <div class="col-sm-9">
                            <textarea class="form-control" id="description"
                                      name="provider[description]"
                                      rows="2"
                                      placeholder="{f:translate(key: 'LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:optional')}">{provider.description}</textarea>
                        </div>
                    </div>
                </div>
            </div>

            <f:comment>Connection Section</f:comment>
            <div class="card mb-4">
                <div class="card-header">
                    <h2 class="card-title"><f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:provider.section.connection" default="Connection Settings" /></h2>
                </div>
                <div class="card-body">
                    <div class="mb-3 row">
                        <label class="col-sm-3 col-form-label" for="adapterType">
                            <f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:provider.field.adapterType" default="Adapter Type" /> *
                        </label>
                        <div class="col-sm-9">
                            <select class="form-select" id="adapterType"
                                    name="provider[adapterType]"
                                    required>
                                <option value="">-- <f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:selectAdapter" default="Select Adapter" /> --</option>
                                <f:for each="{adapterTypes}" as="label" key="value">
                                    <option value="{value}"
                                            {f:if(condition: '{provider.adapterType} == {value}', then: 'selected')}>
                                        {label}
                                    </option>
                                </f:for>
                            </select>
                            <div class="form-text"><f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:provider.field.adapterType.help" default="The API protocol adapter to use" /></div>
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <label class="col-sm-3 col-form-label" for="endpointUrl">
                            <f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:provider.field.endpointUrl" default="Endpoint URL" />
                        </label>
                        <div class="col-sm-9">
                            <input type="url" class="form-control" id="endpointUrl"
                                   name="provider[endpointUrl]"
                                   value="{provider.endpointUrl}"
                                   placeholder="https://api.openai.com/v1" />
                            <div class="form-text"><f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:provider.field.endpointUrl.help" default="Custom API endpoint URL (leave empty for default)" /></div>
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <label class="col-sm-3 col-form-label" for="apiKey">
                            <f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:provider.field.apiKey" default="API Key" /> *
                        </label>
                        <div class="col-sm-9">
                            <input type="password" class="form-control" id="apiKey"
                                   name="provider[apiKey]"
                                   value="{provider.apiKey}"
                                   placeholder="sk-..." />
                            <div class="form-text"><f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:provider.field.apiKey.help" default="Your API key for authentication" /></div>
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <label class="col-sm-3 col-form-label" for="organizationId">
                            <f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:provider.field.organizationId" default="Organization ID" />
                        </label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control" id="organizationId"
                                   name="provider[organizationId]"
                                   value="{provider.organizationId}"
                                   placeholder="org-..." />
                            <div class="form-text"><f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:provider.field.organizationId.help" default="Optional organization ID (OpenAI, Azure)" /></div>
                        </div>
                    </div>
                </div>
            </div>

            <f:comment>Advanced Settings</f:comment>
            <div class="card mb-4">
                <div class="card-header">
                    <h2 class="card-title"><f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:provider.section.advanced" default="Advanced Settings" /></h2>
                </div>
                <div class="card-body">
                    <div class="mb-3 row">
                        <label class="col-sm-3 col-form-label" for="apiTimeout">
                            <f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:provider.field.apiTimeout" default="API Timeout (seconds)" />
                        </label>
                        <div class="col-sm-9">
                            <input type="number" class="form-control" id="apiTimeout"
                                   name="provider[apiTimeout]"
                                   value="{f:if(condition: provider, then: provider.apiTimeout, else: '30')}"
                                   min="1" max="300" />
                            <div class="form-text"><f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:provider.field.apiTimeout.help" default="Timeout for API operations (list models, test connection)" /></div>
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <label class="col-sm-3 col-form-label" for="maxRetries">
                            <f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:provider.field.maxRetries" default="Max Retries" />
                        </label>
                        <div class="col-sm-9">
                            <input type="number" class="form-control" id="maxRetries"
                                   name="provider[maxRetries]"
                                   value="{f:if(condition: provider, then: provider.maxRetries, else: '3')}"
                                   min="0" max="10" />
                            <div class="form-text"><f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:provider.field.maxRetries.help" default="Number of retry attempts on failure" /></div>
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <label class="col-sm-3 col-form-label" for="options">
                            <f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:provider.field.options" default="Additional Options" />
                        </label>
                        <div class="col-sm-9">
                            <textarea class="form-control" id="options"
                                      name="provider[options]"
                                      rows="3"
                                      placeholder='{{"custom_header": "value"}}'>{provider.options}</textarea>
                            <div class="form-text"><f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:provider.field.options.help" default="Additional provider-specific options as JSON" /></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <f:comment>Status Section</f:comment>
            <div class="card mb-4">
                <div class="card-header">
                    <h2 class="card-title"><f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:provider.section.status" default="Status" /></h2>
                </div>
                <div class="card-body">
                    <div class="form-check mb-3">
                        <input type="hidden" name="provider[isActive]" value="0" />
                        <input type="checkbox" class="form-check-input" id="isActive"
                               name="provider[isActive]" value="1"
                               {f:if(condition: '{provider.isActive} || {isNew}', then: 'checked')} />
                        <label class="form-check-label" for="isActive">
                            <f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:active" default="Active" />
                        </label>
                    </div>
                </div>
            </div>

            <f:comment>Actions</f:comment>
            <div class="card mb-4">
                <div class="card-body">
                    <button type="submit" class="btn btn-primary w-100 mb-2">
                        <core:icon identifier="actions-save" size="small" />
                        <f:if condition="{isNew}">
                            <f:then><f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:createProvider" default="Create Provider" /></f:then>
                            <f:else><f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:saveProvider" default="Save Provider" /></f:else>
                        </f:if>
                    </button>
                    <f:link.action action="list" class="btn btn-default w-100">
                        <f:translate key="LLL:EXT:core/Resources/Private/Language/locallang_common.xlf:cancel" default="Cancel" />
                    </f:link.action>
                </div>
            </div>

            <f:comment>Help Section</f:comment>
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title"><f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:help" default="Help" /></h2>
                </div>
                <div class="card-body">
                    <h3><f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:adapterTypes" default="Adapter Types" /></h3>
                    <dl class="mb-0">
                        <dt>OpenAI</dt>
                        <dd class="text-body-secondary"><f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:adapter.openai.description" default="For OpenAI API and compatible endpoints" /></dd>
                        <dt>Anthropic</dt>
                        <dd class="text-body-secondary"><f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:adapter.anthropic.description" default="For Claude models via Anthropic API" /></dd>
                        <dt>Gemini</dt>
                        <dd class="text-body-secondary"><f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:adapter.gemini.description" default="For Google Gemini models" /></dd>
                        <dt>OpenRouter</dt>
                        <dd class="text-body-secondary"><f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:adapter.openrouter.description" default="Multi-provider router service" /></dd>
                        <dt>Ollama</dt>
                        <dd class="text-body-secondary"><f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:adapter.ollama.description" default="Local Ollama instance" /></dd>
                        <dt>Azure OpenAI</dt>
                        <dd class="text-body-secondary"><f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:adapter.azure.description" default="Azure-hosted OpenAI models" /></dd>
                    </dl>
                </div>
            </div>
        </div>
    </div>
</f:section>

</html>
