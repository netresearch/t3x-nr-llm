<html xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers"
      xmlns:be="http://typo3.org/ns/TYPO3/CMS/Backend/ViewHelpers"
      xmlns:core="http://typo3.org/ns/TYPO3/CMS/Core/ViewHelpers"
      data-namespace-typo3-fluid="true">

<f:layout name="Module" />

<f:section name="Content">
    <div class="container">
        <f:be.infobox
            title="One-Shot Prompt Tasks"
            state="{f:constant(name: 'TYPO3\CMS\Core\Type\ContextualFeedbackSeverity::NOTICE')}"
        >
            <p>
                <strong>Important:</strong> Tasks are simple one-shot prompts with limited capabilities.
                They are <strong>NOT</strong> AI agents and cannot perform multi-step reasoning, use tools,
                or maintain conversation context. They are primarily for demonstration and simple utility purposes.
            </p>
        </f:be.infobox>

        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>
                <core:icon identifier="actions-bolt" size="medium" />
                Tasks ({totalCount})
            </h1>
            <a href="{newUrl}" class="btn btn-primary">
                <core:icon identifier="actions-plus" size="small" />
                Create Task
            </a>
        </div>

        <f:if condition="{totalCount} == 0">
            <f:then>
                <f:be.infobox
                    title="No Tasks Configured"
                    state="{f:constant(name: 'TYPO3\CMS\Core\Type\ContextualFeedbackSeverity::INFO')}"
                >
                    <p>No tasks have been created yet. Use the seed data or create your first task.</p>
                </f:be.infobox>
            </f:then>
            <f:else>
                <f:for each="{groupedTasks}" as="group" key="categoryKey">
                    <div class="card mb-4">
                        <div class="card-header">
                            <h2 class="card-title mb-0">
                                <f:switch expression="{categoryKey}">
                                    <f:case value="log_analysis"><core:icon identifier="actions-document-view" size="small" /></f:case>
                                    <f:case value="content"><core:icon identifier="mimetypes-text-text" size="small" /></f:case>
                                    <f:case value="system"><core:icon identifier="actions-system-extension-configure" size="small" /></f:case>
                                    <f:case value="developer"><core:icon identifier="actions-code" size="small" /></f:case>
                                    <f:defaultCase><core:icon identifier="actions-bolt" size="small" /></f:defaultCase>
                                </f:switch>
                                {group.label}
                            </h2>
                        </div>
                        <div class="card-body p-0">
                            <table class="table table-striped table-hover mb-0">
                                <thead>
                                    <tr>
                                        <th style="width: 40px;"></th>
                                        <th>Name</th>
                                        <th>Identifier</th>
                                        <th>Input</th>
                                        <th>Output</th>
                                        <th style="width: 200px;">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <f:for each="{group.tasks}" as="task">
                                        <tr class="{f:if(condition: '!{task.isActive}', then: 'table-secondary')}">
                                            <td>
                                                <f:if condition="{task.isActive}">
                                                    <f:then>
                                                        <span class="badge text-bg-success" title="Active">
                                                            <core:icon identifier="actions-check" size="small" />
                                                        </span>
                                                    </f:then>
                                                    <f:else>
                                                        <span class="badge text-bg-secondary" title="Inactive">
                                                            <core:icon identifier="actions-close" size="small" />
                                                        </span>
                                                    </f:else>
                                                </f:if>
                                            </td>
                                            <td>
                                                <strong>{task.name}</strong>
                                                <f:if condition="{task.isSystem}">
                                                    <span class="badge text-bg-info ms-1" title="System task">System</span>
                                                </f:if>
                                                <f:if condition="{task.description}">
                                                    <br><small class="text-muted">{task.description}</small>
                                                </f:if>
                                            </td>
                                            <td><code>{task.identifier}</code></td>
                                            <td>
                                                <span class="badge text-bg-secondary">{task.inputType}</span>
                                            </td>
                                            <td>
                                                <span class="badge text-bg-secondary">{task.outputFormat}</span>
                                            </td>
                                            <td>
                                                <div class="btn-group btn-group-sm">
                                                    <f:if condition="{task.isActive}">
                                                        <f:link.action action="executeForm" arguments="{uid: task.uid}" class="btn btn-success" title="Execute">
                                                            <core:icon identifier="actions-play" size="small" />
                                                            Run
                                                        </f:link.action>
                                                    </f:if>
                                                    <a href="{editUrls.{task.uid}}" class="btn btn-default" title="Edit">
                                                        <core:icon identifier="actions-open" size="small" />
                                                    </a>
                                                </div>
                                            </td>
                                        </tr>
                                    </f:for>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </f:for>
            </f:else>
        </f:if>
    </div>
</f:section>

</html>
