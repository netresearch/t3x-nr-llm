<html xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers"
      xmlns:core="http://typo3.org/ns/TYPO3/CMS/Core/ViewHelpers"
      data-namespace-typo3-fluid="true">

<f:layout name="Module" />

<f:section name="Content">
    <div class="container">
        <h1>
            <f:if condition="{isNew}">
                <f:then><f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:model.edit.new" default="New LLM Model" /></f:then>
                <f:else><f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:model.edit.edit" default="Edit Model" />: {model.name}</f:else>
            </f:if>
        </h1>

        <f:if condition="{isNew}">
        <f:then>
            <f:form action="create" method="post">
                <f:render section="FormFields" arguments="{_all}" />
            </f:form>
        </f:then>
        <f:else>
            <f:form action="update" method="post" arguments="{uid: model.uid}">
                <f:render section="FormFields" arguments="{_all}" />
            </f:form>
        </f:else>
    </f:if>
    </div>
</f:section>

<f:section name="FormFields">
    <div class="row">
        <div class="col-lg-8">
            <f:comment>Identity Section</f:comment>
            <div class="card mb-4">
                <div class="card-header">
                    <h2 class="card-title"><f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:model.section.identity" default="Identity" /></h2>
                </div>
                <div class="card-body">
                    <div class="mb-3 row">
                        <label class="col-sm-3 col-form-label" for="identifier">
                            <f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:model.field.identifier" default="Identifier" /> *
                        </label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control" id="identifier"
                                   name="model[identifier]"
                                   value="{model.identifier}"
                                   required
                                   pattern="[a-z0-9_-]+"
                                   placeholder="gpt4o_openai" />
                            <div class="form-text"><f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:model.field.identifier.help" default="Unique technical identifier (lowercase, no spaces)" /></div>
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <label class="col-sm-3 col-form-label" for="name">
                            <f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:model.field.name" default="Name" /> *
                        </label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control" id="name"
                                   name="model[name]"
                                   value="{model.name}"
                                   required
                                   placeholder="GPT-4o" />
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <label class="col-sm-3 col-form-label" for="description">
                            <f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:model.field.description" default="Description" />
                        </label>
                        <div class="col-sm-9">
                            <textarea class="form-control" id="description"
                                      name="model[description]"
                                      rows="2"
                                      placeholder="{f:translate(key: 'LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:optional')}">{model.description}</textarea>
                        </div>
                    </div>
                </div>
            </div>

            <f:comment>Provider and Model Section</f:comment>
            <div class="card mb-4">
                <div class="card-header">
                    <h2 class="card-title"><f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:model.section.providerModel" default="Provider and Model" /></h2>
                </div>
                <div class="card-body">
                    <div class="mb-3 row">
                        <label class="col-sm-3 col-form-label" for="providerUid">
                            <f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:model.field.provider" default="Provider" /> *
                        </label>
                        <div class="col-sm-9">
                            <select class="form-select" id="providerUid"
                                    name="model[providerUid]"
                                    required>
                                <option value="">-- <f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:selectProvider" default="Select Provider" /> --</option>
                                <f:for each="{providers}" as="provider">
                                    <option value="{provider.uid}"
                                            {f:if(condition: '{model.providerUid} == {provider.uid}', then: 'selected')}>
                                        {provider.name} ({provider.adapterName})
                                    </option>
                                </f:for>
                            </select>
                            <div class="form-text"><f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:model.field.provider.help" default="The API provider for this model" /></div>
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <label class="col-sm-3 col-form-label" for="modelId">
                            <f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:model.field.modelId" default="Model ID" /> *
                        </label>
                        <div class="col-sm-9">
                            <div class="input-group">
                                <input type="text" class="form-control" id="modelId"
                                       name="model[modelId]"
                                       value="{model.modelId}"
                                       required
                                       placeholder="gpt-4o"
                                       list="modelIdSuggestions"
                                       autocomplete="off" />
                                <button type="button" class="btn btn-default" id="fetchModelsButton"
                                        data-action="fetch-models"
                                        title="{f:translate(key: 'LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:model.fetchModels.title', default: 'Fetch available models from provider')}">
                                    <core:icon identifier="actions-refresh" size="small" />
                                    <f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:model.fetchModels" default="Fetch Models" />
                                </button>
                                <button type="button" class="btn btn-default" id="autoDetectButton"
                                        data-action="detect-limits"
                                        title="{f:translate(key: 'LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:model.autoDetect.title', default: 'Auto-detect model limits and capabilities from provider API')}">
                                    <core:icon identifier="actions-search" size="small" />
                                    <f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:model.detectInfo" default="Detect Info" />
                                </button>
                            </div>
                            <datalist id="modelIdSuggestions"></datalist>
                            <div class="form-text"><f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:model.field.modelId.help" default="The model identifier as used in API calls. Click 'Fetch Models' to load available models from the selected provider." /></div>
                        </div>
                    </div>
                </div>
            </div>

            <f:comment>Capabilities Section</f:comment>
            <div class="card mb-4">
                <div class="card-header">
                    <h2 class="card-title"><f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:model.section.capabilities" default="Capabilities" /></h2>
                </div>
                <div class="card-body">
                    <p class="text-muted mb-3">Select the features this model supports. These are used for model selection and compatibility checks.</p>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input" id="cap_chat"
                                       name="model[capabilities][]" value="chat"
                                       {f:if(condition: hasChat, then: 'checked')}>
                                <label class="form-check-label" for="cap_chat">
                                    <strong>Chat</strong>
                                    <small class="d-block text-muted">Conversational interactions with message history</small>
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input" id="cap_completion"
                                       name="model[capabilities][]" value="completion"
                                       {f:if(condition: hasCompletion, then: 'checked')}>
                                <label class="form-check-label" for="cap_completion">
                                    <strong>Completion</strong>
                                    <small class="d-block text-muted">Text completion without conversation context</small>
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input" id="cap_embeddings"
                                       name="model[capabilities][]" value="embeddings"
                                       {f:if(condition: hasEmbeddings, then: 'checked')}>
                                <label class="form-check-label" for="cap_embeddings">
                                    <strong>Embeddings</strong>
                                    <small class="d-block text-muted">Generate vector embeddings for semantic search</small>
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input" id="cap_vision"
                                       name="model[capabilities][]" value="vision"
                                       {f:if(condition: hasVision, then: 'checked')}>
                                <label class="form-check-label" for="cap_vision">
                                    <strong>Vision</strong>
                                    <small class="d-block text-muted">Process and analyze images</small>
                                </label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input" id="cap_streaming"
                                       name="model[capabilities][]" value="streaming"
                                       {f:if(condition: hasStreaming, then: 'checked')}>
                                <label class="form-check-label" for="cap_streaming">
                                    <strong>Streaming</strong>
                                    <small class="d-block text-muted">Stream responses token by token</small>
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input" id="cap_tools"
                                       name="model[capabilities][]" value="tools"
                                       {f:if(condition: hasTools, then: 'checked')}>
                                <label class="form-check-label" for="cap_tools">
                                    <strong>Tool Use</strong>
                                    <small class="d-block text-muted">Call external functions/tools (function calling)</small>
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input" id="cap_json_mode"
                                       name="model[capabilities][]" value="json_mode"
                                       {f:if(condition: hasJsonMode, then: 'checked')}>
                                <label class="form-check-label" for="cap_json_mode">
                                    <strong>JSON Mode</strong>
                                    <small class="d-block text-muted">Guaranteed valid JSON output</small>
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input" id="cap_audio"
                                       name="model[capabilities][]" value="audio"
                                       {f:if(condition: hasAudio, then: 'checked')}>
                                <label class="form-check-label" for="cap_audio">
                                    <strong>Audio</strong>
                                    <small class="d-block text-muted">Process audio input or generate audio output</small>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <f:comment>Limits Section</f:comment>
            <div class="card mb-4">
                <div class="card-header">
                    <h2 class="card-title"><f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:model.section.limits" default="Model Limits" /></h2>
                </div>
                <div class="card-body">
                    <div class="mb-3 row">
                        <label class="col-sm-3 col-form-label" for="contextLength">
                            <f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:model.field.contextLength" default="Context Length" />
                        </label>
                        <div class="col-sm-9">
                            <input type="number" class="form-control" id="contextLength"
                                   name="model[contextLength]"
                                   value="{f:if(condition: model, then: model.contextLength, else: '0')}"
                                   min="0" />
                            <div class="form-text"><f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:model.field.contextLength.help" default="Maximum context window in tokens (0 = unknown)" /></div>
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <label class="col-sm-3 col-form-label" for="maxOutputTokens">
                            <f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:model.field.maxOutputTokens" default="Max Output Tokens" />
                        </label>
                        <div class="col-sm-9">
                            <input type="number" class="form-control" id="maxOutputTokens"
                                   name="model[maxOutputTokens]"
                                   value="{f:if(condition: model, then: model.maxOutputTokens, else: '0')}"
                                   min="0" />
                            <div class="form-text"><f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:model.field.maxOutputTokens.help" default="Maximum output tokens per request (0 = unknown)" /></div>
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <label class="col-sm-3 col-form-label" for="defaultTimeout">
                            <f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:model.field.defaultTimeout" default="Default Timeout" />
                        </label>
                        <div class="col-sm-9">
                            <div class="input-group">
                                <input type="number" class="form-control" id="defaultTimeout"
                                       name="model[defaultTimeout]"
                                       value="{f:if(condition: model, then: model.defaultTimeout, else: '120')}"
                                       min="0" max="600" />
                                <span class="input-group-text"><f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:seconds" default="seconds" /></span>
                            </div>
                            <div class="form-text"><f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:model.field.defaultTimeout.help" default="Default timeout for LLM inference (thinking models may need longer)" /></div>
                        </div>
                    </div>
                </div>
            </div>

            <f:comment>Pricing Section</f:comment>
            <div class="card mb-4">
                <div class="card-header">
                    <h2 class="card-title"><f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:model.section.pricing" default="Pricing" /></h2>
                </div>
                <div class="card-body">
                    <div class="mb-3 row">
                        <label class="col-sm-3 col-form-label" for="costInput">
                            <f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:model.field.costInput" default="Input Cost" />
                        </label>
                        <div class="col-sm-9">
                            <div class="input-group">
                                <input type="number" class="form-control" id="costInput"
                                       name="model[costInput]"
                                       value="{f:if(condition: model, then: model.costInput, else: '0')}"
                                       min="0" />
                                <span class="input-group-text"><f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:centsPerMillion" default="cents / 1M tokens" /></span>
                            </div>
                            <div class="form-text"><f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:model.field.costInput.help" default="Cost per 1 million input tokens in cents" /></div>
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <label class="col-sm-3 col-form-label" for="costOutput">
                            <f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:model.field.costOutput" default="Output Cost" />
                        </label>
                        <div class="col-sm-9">
                            <div class="input-group">
                                <input type="number" class="form-control" id="costOutput"
                                       name="model[costOutput]"
                                       value="{f:if(condition: model, then: model.costOutput, else: '0')}"
                                       min="0" />
                                <span class="input-group-text"><f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:centsPerMillion" default="cents / 1M tokens" /></span>
                            </div>
                            <div class="form-text"><f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:model.field.costOutput.help" default="Cost per 1 million output tokens in cents" /></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <f:comment>Status Section</f:comment>
            <div class="card mb-4">
                <div class="card-header">
                    <h2 class="card-title"><f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:model.section.status" default="Status" /></h2>
                </div>
                <div class="card-body">
                    <div class="form-check mb-3">
                        <input type="hidden" name="model[isActive]" value="0" />
                        <input type="checkbox" class="form-check-input" id="isActive"
                               name="model[isActive]" value="1"
                               {f:if(condition: '{model.isActive} || {isNew}', then: 'checked')} />
                        <label class="form-check-label" for="isActive">
                            <f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:active" default="Active" />
                        </label>
                    </div>
                    <div class="form-check mb-3">
                        <input type="hidden" name="model[isDefault]" value="0" />
                        <input type="checkbox" class="form-check-input" id="isDefault"
                               name="model[isDefault]" value="1"
                               {f:if(condition: model.isDefault, then: 'checked')} />
                        <label class="form-check-label" for="isDefault">
                            <f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:defaultModel" default="Default Model" />
                        </label>
                    </div>
                </div>
            </div>

            <f:comment>Actions</f:comment>
            <div class="card mb-4">
                <div class="card-body">
                    <button type="submit" class="btn btn-primary w-100 mb-2">
                        <core:icon identifier="actions-save" size="small" />
                        <f:if condition="{isNew}">
                            <f:then><f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:createModel" default="Create Model" /></f:then>
                            <f:else><f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:saveModel" default="Save Model" /></f:else>
                        </f:if>
                    </button>
                    <f:link.action action="list" class="btn btn-default w-100">
                        <f:translate key="LLL:EXT:core/Resources/Private/Language/locallang_common.xlf:cancel" default="Cancel" />
                    </f:link.action>
                </div>
            </div>

            <f:comment>Common Models Reference</f:comment>
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title"><f:translate key="LLL:EXT:nr_llm/Resources/Private/Language/locallang.xlf:commonModelIds" default="Common Model IDs" /></h2>
                </div>
                <div class="card-body">
                    <h3>OpenAI (GPT-5.2)</h3>
                    <ul class="list-unstyled small text-body-secondary mb-3">
                        <li>gpt-5.2-instant</li>
                        <li>gpt-5.2-thinking</li>
                        <li>gpt-5.1</li>
                        <li>gpt-5</li>
                        <li>o4-mini</li>
                    </ul>
                    <h3>Anthropic (Claude 4.5)</h3>
                    <ul class="list-unstyled small text-body-secondary mb-3">
                        <li>claude-opus-4-5-20251101</li>
                        <li>claude-sonnet-4-5-20250929</li>
                        <li>claude-haiku-4-5-20251015</li>
                    </ul>
                    <h3>Google (Gemini 3)</h3>
                    <ul class="list-unstyled small text-body-secondary mb-0">
                        <li>gemini-3-pro-preview</li>
                        <li>gemini-3-flash-preview</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</f:section>

</html>
